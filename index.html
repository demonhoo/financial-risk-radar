
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Financial Risk Radar</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        #controls {
            margin-bottom: 30px;
        }
        #regionSelect, #quarterSlider {
            font-size: 16px;
            padding: 6px;
        }
    </style>
</head>
<body>
    <h2>ðŸ“Š Financial Risk Radar (2022Q1â€“2026Q4)</h2>
    <div id="controls">
        <label>Region:</label>
        <select id="regionSelect"></select>
        <label style="margin-left: 20px;">Quarter:</label>
        <input type="range" id="quarterSlider" min="0" max="0" step="1" value="0" style="width:300px;">
        <span id="quarterLabel"></span>
    </div>
    <div id="chart"></div>

    <script>
        let data = [];
        let allTimes = [];
        let allRegions = [];

        fetch('data.json')
        .then(response => response.json())
        .then(json => {
            data = json;
            allTimes = Array.from(new Set(data.map(d => d.Time))).sort((a, b) => {
                const [ay, aq] = a.split('_Q'); const [by, bq] = b.split('_Q');
                return parseInt(ay)*4 + parseInt(aq) - (parseInt(by)*4 + parseInt(bq));
            });
            allRegions = Array.from(new Set(data.map(d => d.Region)));

            populateControls();
            updateChart();
        });

        function populateControls() {
            const regionSelect = document.getElementById('regionSelect');
            allRegions.forEach(region => {
                const opt = document.createElement("option");
                opt.value = region;
                opt.text = region;
                regionSelect.appendChild(opt);
            });

            const slider = document.getElementById('quarterSlider');
            slider.max = allTimes.length - 1;
            slider.value = allTimes.length - 1;
            document.getElementById('quarterLabel').innerText = allTimes[slider.value];

            slider.oninput = () => {
                document.getElementById('quarterLabel').innerText = allTimes[slider.value];
                updateChart();
            };
            regionSelect.onchange = updateChart;
        }

        function updateChart() {
            const selectedRegion = document.getElementById('regionSelect').value;
            const selectedTime = allTimes[document.getElementById('quarterSlider').value];

            const regionData = data.filter(d => d.Region === selectedRegion && d.Time === selectedTime);
            if (regionData.length === 0) return;

            const theta = regionData.map(d => `${d["Risk Dimension"]} ${d["Trend"]}`);
            const r = regionData.map(d => d.Score);
            theta.push(theta[0]); r.push(r[0]);

            const forecast = regionData[0].Forecast;
            const pressure = regionData[0]["Pressure Index"];
            const dashStyle = forecast ? 'dot' : 'solid';
            const opacity = forecast ? 0.5 : 1.0;

            let color = "#1f77b4"; // Default Global
            if (selectedRegion === "USA") color = "#d62728";
            else if (selectedRegion === "China") color = "#2ca02c";
            else if (selectedRegion === "Eurozone") color = "#9467bd";

            const fig = {
                data: [
                    {
                        type: "scatterpolar",
                        r: r,
                        theta: theta,
                        fill: "toself",
                        name: selectedRegion,
                        line: { color: color, dash: dashStyle },
                        opacity: opacity
                    },
                    {
                        type: "indicator",
                        mode: "gauge+number",
                        value: pressure,
                        title: { text: "Financial Stress Index" },
                        gauge: {
                            axis: { range: [0, 100] },
                            bar: { color: color },
                            steps: [
                                { range: [0, 40], color: "lightgreen" },
                                { range: [40, 70], color: "orange" },
                                { range: [70, 100], color: "red" }
                            ]
                        },
                        domain: { x: [0.75, 1], y: [0, 0.3] }
                    }
                ],
                layout: {
                    polar: { radialaxis: { visible: true, range: [0, 5] } },
                    showlegend: false,
                    height: 600,
                    margin: { t: 60, b: 80 }
                }
            };

            Plotly.newPlot('chart', fig.data, fig.layout);
        }
    </script>
</body>
</html>
